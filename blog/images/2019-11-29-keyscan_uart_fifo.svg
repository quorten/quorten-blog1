<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Created with Inkscape (http://www.inkscape.org/) -->

<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   width="1375"
   height="360"
   viewBox="0 0 1375 360"
   id="svg3725"
   version="1.1"
   inkscape:version="0.91 r13725"
   sodipodi:docname="2019-11-29-keyscan_uart_fifo.svg">
  <defs
     id="defs3727">
    <marker
       inkscape:stockid="Arrow1Mend"
       orient="auto"
       refY="0"
       refX="0"
       id="Arrow1Mend"
       style="overflow:visible">
      <path
         id="path3851"
         d="M 0,0 5,-5 -12.5,0 5,5 0,0 Z"
         style="fill-rule:evenodd;stroke:#000000;stroke-width:1pt;marker-start:none"
         transform="matrix(-0.4,0,0,-0.4,-4,0)"
         inkscape:connector-curvature="0" />
    </marker>
  </defs>
  <sodipodi:namedview
     id="base"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:pageopacity="0.0"
     inkscape:pageshadow="2"
     inkscape:zoom="0.5"
     inkscape:cx="655.68552"
     inkscape:cy="250.44445"
     inkscape:document-units="px"
     inkscape:current-layer="layer1"
     showgrid="false"
     units="px"
     inkscape:window-width="1364"
     inkscape:window-height="700"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="1" />
  <metadata
     id="metadata3730">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title></dc:title>
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g
     inkscape:label="Layer 1"
     inkscape:groupmode="layer"
     id="layer1">
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       x="208.76028"
       y="21.622393"
       id="text3627"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         x="208.76028"
         y="21.622393"
         id="tspan3783">UART accesses all key msgs memory on</tspan><tspan
         sodipodi:role="line"
         x="208.76028"
         y="40.372395"
         id="tspan3785">alternating cycles compared to keyboard</tspan><tspan
         sodipodi:role="line"
         x="208.76028"
         y="59.122391"
         id="tspan3787">scanner to avoid simultaneous writes to</tspan><tspan
         sodipodi:role="line"
         x="208.76028"
         y="77.872391"
         id="tspan3789">memory.</tspan></text>
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       x="28.650305"
       y="146.4104"
       id="text3791"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         id="tspan3793"
         x="28.650305"
         y="146.4104">!old &amp; cur =&gt; keydown</tspan></text>
    <rect
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none"
       id="rect3795"
       width="171.15582"
       height="34"
       x="18.876865"
       y="125.4077" />
    <text
       sodipodi:linespacing="125%"
       id="text3797"
       y="200.41046"
       x="28.650305"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       xml:space="preserve"><tspan
         y="200.41046"
         x="28.650305"
         id="tspan3799"
         sodipodi:role="line">old &amp; !cur =&gt; keyup</tspan></text>
    <rect
       y="179.40778"
       x="18.876865"
       height="34"
       width="171.15582"
       id="rect3801"
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none" />
    <path
       inkscape:connector-curvature="0"
       id="path3803"
       d="m 190.03271,141.54359 39.8442,0.7071"
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)" />
    <path
       inkscape:connector-curvature="0"
       id="path3805"
       d="m 190.03271,198.81919 39.8442,-49.4974"
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)" />
    <text
       sodipodi:linespacing="125%"
       id="text3807"
       y="150.65309"
       x="239.6503"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       xml:space="preserve"><tspan
         y="150.65309"
         x="239.6503"
         id="tspan3809"
         sodipodi:role="line">all key msgs</tspan></text>
    <rect
       y="129.65033"
       x="229.87686"
       height="34"
       width="105.15576"
       id="rect3811"
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none" />
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       x="28.650305"
       y="90.99614"
       id="text3813"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         id="tspan3815"
         x="28.650305"
         y="90.99614">old == cur =&gt; nil</tspan></text>
    <rect
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none"
       id="rect3817"
       width="171.15582"
       height="34"
       x="18.876865"
       y="69.993462" />
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       x="382.48587"
       y="122.36875"
       id="text3819"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         id="tspan3821"
         x="382.48587"
         y="122.36875">!(UART full)</tspan></text>
    <rect
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none"
       id="rect3823"
       width="105.15576"
       height="34"
       x="372.71243"
       y="101.36607" />
    <text
       sodipodi:linespacing="125%"
       id="text3825"
       y="212.87848"
       x="382.48587"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       xml:space="preserve"><tspan
         y="212.87848"
         x="382.48587"
         id="tspan3827"
         sodipodi:role="line">UART full</tspan></text>
    <rect
       y="191.87579"
       x="372.71243"
       height="34"
       width="105.15576"
       id="rect3829"
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none" />
    <path
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)"
       d="m 335.03261,137.30099 37.6798,-19.79903"
       id="path3831"
       inkscape:connector-curvature="0" />
    <path
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)"
       d="m 335.03261,150.02889 37.6798,60.1041"
       id="path3833"
       inkscape:connector-curvature="0"
       sodipodi:nodetypes="cc" />
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       x="516.83618"
       y="212.87848"
       id="text3835"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         id="tspan3837"
         x="516.83618"
         y="212.87848">Do nothing.</tspan></text>
    <rect
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none"
       id="rect3839"
       width="105.15576"
       height="34"
       x="507.06277"
       y="191.87579" />
    <path
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)"
       d="m 477.86821,206.59739 29.1946,0"
       id="path3841"
       inkscape:connector-curvature="0" />
    <text
       sodipodi:linespacing="125%"
       id="text3843"
       y="122.36875"
       x="518.25037"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       xml:space="preserve"><tspan
         y="122.36875"
         x="518.25037"
         id="tspan3845"
         sodipodi:role="line">Write nil to key msg</tspan></text>
    <rect
       y="101.36607"
       x="508.47696"
       height="34"
       width="148.99638"
       id="rect3847"
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none" />
    <path
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)"
       d="m 523.08431,101.36609 0,-9.499997 -285.6711,0 0,37.784267"
       id="path3849"
       inkscape:connector-curvature="0"
       sodipodi:nodetypes="cccc" />
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       x="518.25037"
       y="156.36871"
       id="text3851"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         id="tspan3853"
         x="518.25037"
         y="156.36871">Shift msg into UART FIFO</tspan></text>
    <rect
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none"
       id="rect3855"
       width="190.00853"
       height="34"
       x="508.47696"
       y="135.36609" />
    <path
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)"
       d="m 477.86821,126.69434 30.6088,0"
       id="path3857"
       inkscape:connector-curvature="0" />
    <text
       sodipodi:linespacing="125%"
       id="text3859"
       y="156.36871"
       x="738.16058"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       xml:space="preserve"><tspan
         y="156.36871"
         x="738.16058"
         id="tspan3861"
         sodipodi:role="line">UART FIFO</tspan></text>
    <rect
       y="135.36609"
       x="728.38715"
       height="34"
       width="92.427811"
       id="rect3863"
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none" />
    <path
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)"
       d="m 698.48551,151.44309 29.9016,0"
       id="path3865"
       inkscape:connector-curvature="0" />
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       x="869.21796"
       y="127.8488"
       id="text3867"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         id="tspan3869"
         x="869.21796"
         y="127.8488">FIFO empty</tspan></text>
    <rect
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none"
       id="rect3871"
       width="99.852417"
       height="34"
       x="859.909"
       y="106.84618" />
    <path
       inkscape:connector-curvature="0"
       id="path3873"
       d="m 820.81501,145.60949 39.094,-22.62746"
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)" />
    <path
       inkscape:connector-curvature="0"
       id="path3875"
       d="m 820.81501,156.92319 39.094,31.8198"
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)" />
    <text
       sodipodi:linespacing="125%"
       id="text3877"
       y="192.19562"
       x="864.26825"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       xml:space="preserve"><tspan
         y="192.19562"
         x="864.26825"
         id="tspan3879"
         sodipodi:role="line">!(FIFO empty)</tspan></text>
    <rect
       y="171.19293"
       x="859.909"
       height="34"
       width="100.55952"
       id="rect3881"
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none" />
    <text
       sodipodi:linespacing="125%"
       id="text3883"
       y="127.8488"
       x="994.08295"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       xml:space="preserve"><tspan
         y="127.8488"
         x="994.08295"
         id="tspan3885"
         sodipodi:role="line">UART encode silence</tspan></text>
    <rect
       y="106.84618"
       x="984.30951"
       height="34"
       width="160.59937"
       id="rect3887"
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none" />
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       x="994.08295"
       y="191.84894"
       id="text3889"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         id="tspan3891"
         x="994.08295"
         y="191.84894">UART encode char</tspan></text>
    <rect
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none"
       id="rect3893"
       width="159.09937"
       height="34"
       x="984.30951"
       y="170.84625" />
    <text
       sodipodi:linespacing="125%"
       id="text3895"
       y="159.84894"
       x="1200.0829"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       xml:space="preserve"><tspan
         y="159.84894"
         x="1200.0829"
         id="tspan3897"
         sodipodi:role="line">shift out UART buffer</tspan></text>
    <rect
       y="138.84619"
       x="1190.3094"
       height="33.999985"
       width="161.09937"
       id="rect3899"
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none" />
    <path
       inkscape:connector-curvature="0"
       id="path3901"
       d="m 1144.9089,123.0457 45.4006,24.99999"
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)" />
    <path
       inkscape:connector-curvature="0"
       id="path3903"
       d="m 1143.4089,187.80829 46.9006,-26.7626"
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)"
       sodipodi:nodetypes="cc" />
    <path
       inkscape:connector-curvature="0"
       id="path3905"
       d="m 960.50841,123.0457 23.8011,0"
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)" />
    <path
       inkscape:connector-curvature="0"
       id="path3907"
       d="m 960.50841,187.04569 23.8011,0"
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)" />
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       x="732.50372"
       y="36.867725"
       id="text3909"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         id="tspan3911"
         x="732.50372"
         y="36.867725">shift out on</tspan><tspan
         sodipodi:role="line"
         x="732.50372"
         y="55.617725"
         id="tspan3915">UART CLOCK</tspan></text>
    <rect
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none"
       id="rect3913"
       width="106.56999"
       height="53.091885"
       x="722.73029"
       y="15.865031" />
    <text
       sodipodi:linespacing="125%"
       id="text3917"
       y="266.6774"
       x="728.26105"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       xml:space="preserve"><tspan
         y="266.6774"
         x="728.26105"
         id="tspan3919"
         sodipodi:role="line">shift in on</tspan><tspan
         id="tspan3921"
         y="285.4274"
         x="728.26105"
         sodipodi:role="line">keyscan clock</tspan></text>
    <rect
       y="245.67474"
       x="722.73029"
       height="53.091885"
       width="106.56999"
       id="rect3923"
       style="fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none" />
    <path
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)"
       d="m 809.46261,68.956923 0,66.409167"
       id="path3925"
       inkscape:connector-curvature="0" />
    <path
       style="fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow1Mend)"
       d="m 738.04481,245.67469 0,-76.3086"
       id="path3927"
       inkscape:connector-curvature="0" />
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none"
       x="518.13452"
       y="246.90253"
       id="text3965"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         id="tspan3967"
         x="518.13452"
         y="246.90253">Alternatively, we could set</tspan><tspan
         sodipodi:role="line"
         x="518.13452"
         y="265.65253"
         id="tspan3969">a &quot;buffer overrun&quot; flag, and</tspan><tspan
         sodipodi:role="line"
         x="518.13452"
         y="284.4025"
         id="tspan3971">the moment the buffer</tspan><tspan
         sodipodi:role="line"
         x="518.13452"
         y="303.1525"
         id="tspan3973">becomes available, we shift</tspan><tspan
         sodipodi:role="line"
         x="518.13452"
         y="321.9025"
         id="tspan3975">out a buffer overrun message</tspan><tspan
         sodipodi:role="line"
         x="518.13452"
         y="340.6525"
         id="tspan3977">and clear the flag.</tspan></text>
  </g>
</svg>
